# Kite Algo MCP Server

A Model Context Protocol (MCP) server that provides algorithmic trading capabilities using the Zerodha Kite Connect API. This server enables automated trading strategies for both equity and options trading with built-in risk management features.

## Features

- **Dual Server Architecture**: Both MCP and HTTP server support
- **Equity Trading Algorithm**: Automated trading based on SMA and VWAP indicators
- **Options Trading Algorithm**: Simulated options trading with configurable parameters
- **Delta Calculation**: Calculate net delta for options portfolios using Black-Scholes model
- **Real-time Data**: Fetch historical and live market data through Kite Connect API
- **Web Dashboard**: Interactive web interface for manual trading operations
- **RESTful API**: HTTP endpoints for external integrations
- **Risk Management**: Built-in logging and trade decision tracking
- **MCP Integration**: Seamless integration with AI agents via Model Context Protocol

## Prerequisites

- Node.js (v16 or higher)
- Zerodha Kite Connect account
- API Key and Secret from Zerodha

## Installation

1. Clone the repository:

```bash
git clone <repository-url>
cd kite-algo-mcp
```

2. Install dependencies:

```bash
npm install
```

3. Set up environment variables:

```bash
cp .env.example .env
```

4. Edit the `.env` file with your Kite Connect credentials:

```env
KITE_API_KEY=your_api_key_here
KITE_API_SECRET=your_api_secret_here
KITE_REQUEST_TOKEN=your_request_token_here
```

## Getting Kite Connect Credentials

1. **API Key & Secret**:

   - Visit [Kite Connect](https://developers.kite.trade/)
   - Create a new app to get your API key and secret

2. **Request Token**:
   - The request token is obtained through the OAuth flow
   - Visit the login URL generated by the server
   - After authorization, extract the request token from the callback URL

## Usage

### Starting the Servers

**MCP Server (for AI agent integration):**

```bash
npm run start:mcp
# or for development
npm run dev:mcp
```

**HTTP Server (web dashboard and API):**

```bash
npm run start:http
# or for development
npm run dev:http
```

**Default HTTP server (backwards compatibility):**

```bash
npm start
# or for development
npm run dev
```

The MCP server connects via stdio transport for AI agent communication.
The HTTP server runs on port 5555 (or PORT environment variable) with a web dashboard.

### Available Tools

#### 1. runTradingAlgorithm

Executes an automated equity trading algorithm based on technical indicators.

**Parameters:**

- `instrumentToken` (number): The instrument token for the stock
- `quantity` (number): Number of shares to trade
- `tradeDurationMinutes` (number): Duration to run the algorithm

**Algorithm Logic:**

- Fetches 5 days of historical data
- Calculates Simple Moving Average (SMA) for last 20 periods
- Calculates Volume Weighted Average Price (VWAP)
- Generates BUY signal when price > SMA and price > VWAP
- Generates SELL signal when price < SMA and price < VWAP

#### 2. runOptionTradingAlgorithm

Executes a simulated options trading algorithm.

**Parameters:**

- `instrumentToken` (number): The option instrument token
- `strikePrice` (number): Strike price of the option
- `optionType` (enum): "CE" for Call or "PE" for Put
- `expiryDate` (string): Expiry date in YYYY-MM-DD format
- `quantity` (number): Number of option lots
- `tradeDurationMinutes` (number): Duration to run the algorithm

#### 3. calculateNetDelta

Calculates the net delta exposure for options positions grouped by underlying.

**Features:**

- Groups positions by underlying instrument
- Uses Black-Scholes model for delta calculation
- Accounts for both call and put options
- Returns net delta exposure per underlying

### HTTP API Endpoints

The HTTP server provides RESTful API endpoints for external integration:

#### Health Check

```
GET /health
```

#### Market Analysis

```
GET /api/analysis/:instrumentToken
```

#### Run Equity Trading Algorithm

```
POST /api/trading/run
Content-Type: application/json

{
  "instrumentToken": 408065,
  "quantity": 100,
  "tradeDurationMinutes": 5
}
```

#### Run Options Trading Algorithm

```
POST /api/options/run
Content-Type: application/json

{
  "instrumentToken": 408065,
  "strikePrice": 2500,
  "optionType": "CE",
  "expiryDate": "2025-07-31",
  "quantity": 1,
  "tradeDurationMinutes": 5
}
```

#### Calculate Portfolio Delta

```
GET /api/delta/calculate
```

#### API Documentation

```
GET /api/docs
```

### Web Dashboard

Access the interactive web dashboard at `http://localhost:5555` when running the HTTP server. The dashboard provides:

- ðŸ“Š **Market Analysis Tool**: Analyze instruments using technical indicators
- ðŸ’¹ **Equity Trading Interface**: Run equity algorithms with custom parameters
- ðŸŽ¯ **Options Trading Interface**: Execute options strategies
- ðŸ“ˆ **Portfolio Delta Calculator**: Real-time delta analysis
- ðŸš€ **Server Health Monitoring**: Live server status

## Project Structure

```
kite-algo-mcp/
â”œâ”€â”€ server.js              # HTTP/Express server with REST API
â”œâ”€â”€ mcpServer.js           # MCP server for AI agent integration
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ tradingService.js  # Shared trading algorithms and utilities
â”œâ”€â”€ public/
â”‚   â””â”€â”€ index.html         # Web dashboard interface
â”œâ”€â”€ data/
â”‚   â””â”€â”€ optionsStockList.js # Options stock symbols and lot sizes
â”œâ”€â”€ package.json           # Node.js dependencies and scripts
â”œâ”€â”€ nodemon.json          # Development server configuration
â”œâ”€â”€ .env.example          # Environment variables template
â”œâ”€â”€ .gitignore            # Git ignore rules
â”œâ”€â”€ CONTRIBUTING.md       # Contribution guidelines
â””â”€â”€ README.md             # This file
```

## Technical Indicators

### Simple Moving Average (SMA)

- Calculated over the last 20 periods
- Used as a trend indicator for buy/sell decisions

### Volume Weighted Average Price (VWAP)

- Calculated using price and volume data
- Provides price level weighted by trading volume

### Black-Scholes Delta

- Used for options risk management
- Calculates price sensitivity to underlying movement
- Formula: Î” = N(d1) for calls, Î” = N(d1) - 1 for puts

## Risk Management

- All trades are logged with detailed information
- Algorithms include position sizing controls
- Built-in error handling and recovery
- Rate limiting to comply with API restrictions

## Configuration

### Environment Variables

| Variable             | Description                  | Required |
| -------------------- | ---------------------------- | -------- |
| `KITE_API_KEY`       | Your Kite Connect API key    | Yes      |
| `KITE_API_SECRET`    | Your Kite Connect API secret | Yes      |
| `KITE_REQUEST_TOKEN` | OAuth request token          | Yes      |

### Trading Parameters

The algorithms use these default parameters:

- Historical data period: 5 days
- SMA period: 20 periods
- Trade evaluation interval: 1 minute
- Risk-free rate: 5% (for options)
- Assumed volatility: 20% (for options)

## Error Handling

The server includes comprehensive error handling:

- Authentication failures
- API rate limiting
- Invalid instrument tokens
- Network connectivity issues
- Data parsing errors

## Logging

All trading activities are logged with:

- Timestamp
- Instrument details
- Trade type (BUY/SELL)
- Quantity and price
- Execution status

## Security Considerations

- Keep your API credentials secure
- Use environment variables for sensitive data
- Regularly rotate your API keys
- Monitor trading activities
- Implement position limits

## Limitations

- Options trading is currently simulated
- Real trading requires proper risk management
- Subject to Kite Connect API rate limits
- Historical data limited to available periods

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## License

This project is licensed under the ISC License.

## Disclaimer

This software is for educational and research purposes only. Trading in financial markets involves substantial risk of loss. The authors are not responsible for any financial losses incurred through the use of this software. Always conduct thorough testing and risk assessment before deploying any automated trading system.

## Support

For support and questions:

- Check the [Kite Connect documentation](https://kite.trade/docs/connect/v3/)
- Review the [Model Context Protocol specification](https://spec.modelcontextprotocol.io/)
- Open an issue in this repository

## Changelog

### v1.0.0

- Initial release
- Basic equity trading algorithm
- Options delta calculation
- MCP server implementation
- Kite Connect integration
